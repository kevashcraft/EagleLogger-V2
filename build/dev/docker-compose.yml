version: '3'
services:
  app:
    build:
      context: ../../
      dockerfile: build/dev/Dockerfile
    ports:
      - 8080:8080
      - 40801:3001
    depends_on:
      - postgres
    volumes:
      - ../src:/app/src
      - ../.git:/app/.git
      - ../build:/app/build
      - ../.babelrc:/app/.babelrc
      - ../package.json:/app/package.json
      - ../node_modules:/app/node_modules
    environment:
      - API_SERVER=${API_SERVER}
      - SENDGRID_API_KEY=${SENDGRID_API_KEY}
  postgres:
    build:
      context: ../
      dockerfile: build/Dockerfile-postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data
  redis:
    image: redis:3.2.11

volumes:
  postgres_data:
